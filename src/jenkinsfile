pipeline {
    agent any

    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
    }
    //1.自定义pipeline 环境变量
    //2. 环境变量间相互引用
    environment {
        __Author = "chenguang09"
        __Server_Name = "Jenkins pipeline!!!!!!"
        __Merge = "service name ${__Server_Name} By ${__Author}"
    }

    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
                sh'printenv'
            }
        }
        stage('Test') {
            steps {
                echo "Running on ${env.BUILD_NUMBER} on ${env.JENKINS_URL}"
                echo "git branch is ${env.GIT_BRANCH}"
                echo "Job '${JOB_NAME}' (${BUILD_NUMBER}) is waiting for input"
                echo "Please go to ${BUILD_URL} and verify the build"
                echo "The author is ${__Author}"
                echo "${__Merge}"
                echo "自定义全局环境变量名称: ${env.g_name}, 值为: ${env.g_value}"

            }
        }
    }
    post {
            always {
                echo 'I will always say Hello!'
                echo "The author is ${__Author}"
            }
            aborted {
                echo 'I was aborted'
            }
            failure {
                mail to: 'cgsnd5669@163.com',
                subject: "Failed Pipeline: ${currentBuild.fullDisplayName}",
                body: "Something is wrong with ${env.BUILD_URL}"
            }
            success {
                echo 'post success !!!'
            }
        }
}
